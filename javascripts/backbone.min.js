(function(){var e,a=this,t=a.Backbone,i=[],s=i.push,n=i.slice,o=i.splice;e="undefined"!=typeof exports?exports:a.Backbone={},e.VERSION="1.0.0";var r=a._;r||"undefined"==typeof require||(r=require("underscore")),e.$=a.jQuery||a.Zepto||a.ender||a.$,e.noConflict=function(){return a.Backbone=t,this},e.emulateHTTP=!1,e.emulateJSON=!1;var c=e.Events={on:function(e,a,t){if(!l(this,"on",e,[a,t])||!a)return this;this._events||(this._events={});var i=this._events[e]||(this._events[e]=[]);return i.push({callback:a,context:t,ctx:t||this}),this},once:function(e,a,t){if(!l(this,"once",e,[a,t])||!a)return this;var i=this,s=r.once(function(){i.off(e,s),a.apply(this,arguments)});return s._callback=a,this.on(e,s,t)},off:function(e,a,t){var i,s,n,o,c,d,m,h;if(!this._events||!l(this,"off",e,[a,t]))return this;if(!e&&!a&&!t)return this._events={},this;for(o=e?[e]:r.keys(this._events),c=0,d=o.length;d>c;c++)if(e=o[c],n=this._events[e]){if(this._events[e]=i=[],a||t)for(m=0,h=n.length;h>m;m++)s=n[m],(a&&a!==s.callback&&a!==s.callback._callback||t&&t!==s.context)&&i.push(s);i.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var a=n.call(arguments,1);if(!l(this,"trigger",e,a))return this;var t=this._events[e],i=this._events.all;return t&&m(t,a),i&&m(i,arguments),this},stopListening:function(e,a,t){var i=this._listeners;if(!i)return this;var s=!a&&!t;"object"==typeof a&&(t=this),e&&((i={})[e._listenerId]=e);for(var n in i)i[n].off(a,t,this),s&&delete this._listeners[n];return this}},d=/\s+/,l=function(e,a,t,i){if(!t)return!0;if("object"==typeof t){for(var s in t)e[a].apply(e,[s,t[s]].concat(i));return!1}if(d.test(t)){for(var n=t.split(d),o=0,r=n.length;r>o;o++)e[a].apply(e,[n[o]].concat(i));return!1}return!0},m=function(e,a){var t,i=-1,s=e.length,n=a[0],o=a[1],r=a[2];switch(a.length){case 0:for(;s>++i;)(t=e[i]).callback.call(t.ctx);return;case 1:for(;s>++i;)(t=e[i]).callback.call(t.ctx,n);return;case 2:for(;s>++i;)(t=e[i]).callback.call(t.ctx,n,o);return;case 3:for(;s>++i;)(t=e[i]).callback.call(t.ctx,n,o,r);return;default:for(;s>++i;)(t=e[i]).callback.apply(t.ctx,a)}},h={listenTo:"on",listenToOnce:"once"};r.each(h,function(e,a){c[a]=function(a,t,i){var s=this._listeners||(this._listeners={}),n=a._listenerId||(a._listenerId=r.uniqueId("l"));return s[n]=a,"object"==typeof t&&(i=this),a[e](t,i,this),this}}),c.bind=c.on,c.unbind=c.off,r.extend(e,c);var f=e.Model=function(e,a){var t,i=e||{};a||(a={}),this.cid=r.uniqueId("c"),this.attributes={},r.extend(this,r.pick(a,p)),a.parse&&(i=this.parse(i,a)||{}),(t=r.result(this,"defaults"))&&(i=r.defaults({},i,t)),this.set(i,a),this.changed={},this.initialize.apply(this,arguments)},p=["url","urlRoot","collection"];r.extend(f.prototype,c,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return r.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return r.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,a,t){var i,s,n,o,c,d,l,m;if(null==e)return this;if("object"==typeof e?(s=e,t=a):(s={})[e]=a,t||(t={}),!this._validate(s,t))return!1;n=t.unset,c=t.silent,o=[],d=this._changing,this._changing=!0,d||(this._previousAttributes=r.clone(this.attributes),this.changed={}),m=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)a=s[i],r.isEqual(m[i],a)||o.push(i),r.isEqual(l[i],a)?delete this.changed[i]:this.changed[i]=a,n?delete m[i]:m[i]=a;if(!c){o.length&&(this._pending=!0);for(var h=0,f=o.length;f>h;h++)this.trigger("change:"+o[h],this,m[o[h]],t)}if(d)return this;if(!c)for(;this._pending;)this._pending=!1,this.trigger("change",this,t);return this._pending=!1,this._changing=!1,this},unset:function(e,a){return this.set(e,void 0,r.extend({},a,{unset:!0}))},clear:function(e){var a={};for(var t in this.attributes)a[t]=void 0;return this.set(a,r.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!r.isEmpty(this.changed):r.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?r.clone(this.changed):!1;var a,t=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e)r.isEqual(i[s],a=e[s])||((t||(t={}))[s]=a);return t},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return r.clone(this._previousAttributes)},fetch:function(e){e=e?r.clone(e):{},void 0===e.parse&&(e.parse=!0);var a=this,t=e.success;return e.success=function(i){return a.set(a.parse(i,e),e)?(t&&t(a,i,e),a.trigger("sync",a,i,e),void 0):!1},j(this,e),this.sync("read",this,e)},save:function(e,a,t){var i,s,n,o=this.attributes;if(null==e||"object"==typeof e?(i=e,t=a):(i={})[e]=a,!(!i||t&&t.wait||this.set(i,t)))return!1;if(t=r.extend({validate:!0},t),!this._validate(i,t))return!1;i&&t.wait&&(this.attributes=r.extend({},o,i)),void 0===t.parse&&(t.parse=!0);var c=this,d=t.success;return t.success=function(e){c.attributes=o;var a=c.parse(e,t);return t.wait&&(a=r.extend(i||{},a)),r.isObject(a)&&!c.set(a,t)?!1:(d&&d(c,e,t),c.trigger("sync",c,e,t),void 0)},j(this,t),s=this.isNew()?"create":t.patch?"patch":"update","patch"===s&&(t.attrs=i),n=this.sync(s,this,t),i&&t.wait&&(this.attributes=o),n},destroy:function(e){e=e?r.clone(e):{};var a=this,t=e.success,i=function(){a.trigger("destroy",a,a.collection,e)};if(e.success=function(s){(e.wait||a.isNew())&&i(),t&&t(a,s,e),a.isNew()||a.trigger("sync",a,s,e)},this.isNew())return e.success(),!1;j(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=r.result(this,"urlRoot")||r.result(this.collection,"url")||N();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},r.extend(e||{},{validate:!0}))},_validate:function(e,a){if(!a.validate||!this.validate)return!0;e=r.extend({},this.attributes,e);var t=this.validationError=this.validate(e,a)||null;return t?(this.trigger("invalid",this,t,r.extend(a||{},{validationError:t})),!1):!0}});var u=["keys","values","pairs","invert","pick","omit"];r.each(u,function(e){f.prototype[e]=function(){var a=n.call(arguments);return a.unshift(this.attributes),r[e].apply(r,a)}});var g=e.Collection=function(e,a){a||(a={}),a.url&&(this.url=a.url),a.model&&(this.model=a.model),void 0!==a.comparator&&(this.comparator=a.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,r.extend({silent:!0},a))},v={add:!0,remove:!0,merge:!0},b={add:!0,merge:!1,remove:!1};r.extend(g.prototype,c,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(a){return a.toJSON(e)})},sync:function(){return e.sync.apply(this,arguments)},add:function(e,a){return this.set(e,r.defaults(a||{},b))},remove:function(e,a){e=r.isArray(e)?e.slice():[e],a||(a={});var t,i,s,n;for(t=0,i=e.length;i>t;t++)n=this.get(e[t]),n&&(delete this._byId[n.id],delete this._byId[n.cid],s=this.indexOf(n),this.models.splice(s,1),this.length--,a.silent||(a.index=s,n.trigger("remove",n,this,a)),this._removeReference(n));return this},set:function(e,a){a=r.defaults(a||{},v),a.parse&&(e=this.parse(e,a)),r.isArray(e)||(e=e?[e]:[]);var t,i,n,c,d,l=a.at,m=this.comparator&&null==l&&a.sort!==!1,h=r.isString(this.comparator)?this.comparator:null,f=[],p=[],u={};for(t=0,i=e.length;i>t;t++)(n=this._prepareModel(e[t],a))&&((c=this.get(n))?(a.remove&&(u[c.cid]=!0),a.merge&&(c.set(n.attributes,a),m&&!d&&c.hasChanged(h)&&(d=!0))):a.add&&(f.push(n),n.on("all",this._onModelEvent,this),this._byId[n.cid]=n,null!=n.id&&(this._byId[n.id]=n)));if(a.remove){for(t=0,i=this.length;i>t;++t)u[(n=this.models[t]).cid]||p.push(n);p.length&&this.remove(p,a)}if(f.length&&(m&&(d=!0),this.length+=f.length,null!=l?o.apply(this.models,[l,0].concat(f)):s.apply(this.models,f)),d&&this.sort({silent:!0}),a.silent)return this;for(t=0,i=f.length;i>t;t++)(n=f[t]).trigger("add",n,this,a);return d&&this.trigger("sort",this,a),this},reset:function(e,a){a||(a={});for(var t=0,i=this.models.length;i>t;t++)this._removeReference(this.models[t]);return a.previousModels=this.models,this._reset(),this.add(e,r.extend({silent:!0},a)),a.silent||this.trigger("reset",this,a),this},push:function(e,a){return e=this._prepareModel(e,a),this.add(e,r.extend({at:this.length},a)),e},pop:function(e){var a=this.at(this.length-1);return this.remove(a,e),a},unshift:function(e,a){return e=this._prepareModel(e,a),this.add(e,r.extend({at:0},a)),e},shift:function(e){var a=this.at(0);return this.remove(a,e),a},slice:function(e,a){return this.models.slice(e,a)},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,a){return r.isEmpty(e)?a?void 0:[]:this[a?"find":"filter"](function(a){for(var t in e)if(e[t]!==a.get(t))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw Error("Cannot sort a set without a comparator");return e||(e={}),r.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(r.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,a,t){a||(a=this.comparator);var i=r.isFunction(a)?a:function(e){return e.get(a)};return r.sortedIndex(this.models,e,i,t)},pluck:function(e){return r.invoke(this.models,"get",e)},fetch:function(e){e=e?r.clone(e):{},void 0===e.parse&&(e.parse=!0);var a=e.success,t=this;return e.success=function(i){var s=e.reset?"reset":"set";t[s](i,e),a&&a(t,i,e),t.trigger("sync",t,i,e)},j(this,e),this.sync("read",this,e)},create:function(e,a){if(a=a?r.clone(a):{},!(e=this._prepareModel(e,a)))return!1;a.wait||this.add(e,a);var t=this,i=a.success;return a.success=function(s){a.wait&&t.add(e,a),i&&i(e,s,a)},e.save(null,a),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,a){if(e instanceof f)return e.collection||(e.collection=this),e;a||(a={}),a.collection=this;var t=new this.model(e,a);return t._validate(e,a)?t:(this.trigger("invalid",this,e,a),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,a,t,i){("add"!==e&&"remove"!==e||t===this)&&("destroy"===e&&this.remove(a,i),a&&e==="change:"+a.idAttribute&&(delete this._byId[a.previous(a.idAttribute)],null!=a.id&&(this._byId[a.id]=a)),this.trigger.apply(this,arguments))}});var C=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];r.each(C,function(e){g.prototype[e]=function(){var a=n.call(arguments);return a.unshift(this.models),r[e].apply(r,a)}});var T=["groupBy","countBy","sortBy"];r.each(T,function(e){g.prototype[e]=function(a,t){var i=r.isFunction(a)?a:function(e){return e.get(a)};return r[e](this.models,i,t)}});var $=e.View=function(e){this.cid=r.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},y=/^(\S+)\s*(.*)$/,S=["model","collection","el","id","attributes","className","tagName","events"];r.extend($.prototype,c,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,t){return this.$el&&this.undelegateEvents(),this.$el=a instanceof e.$?a:e.$(a),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=r.result(this,"events")))return this;this.undelegateEvents();for(var a in e){var t=e[a];if(r.isFunction(t)||(t=this[e[a]]),t){var i=a.match(y),s=i[1],n=i[2];t=r.bind(t,this),s+=".delegateEvents"+this.cid,""===n?this.$el.on(s,t):this.$el.on(s,n,t)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=r.extend({},r.result(this,"options"),e)),r.extend(this,r.pick(e,S)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(r.result(this,"el"),!1);else{var a=r.extend({},r.result(this,"attributes"));this.id&&(a.id=r.result(this,"id")),this.className&&(a["class"]=r.result(this,"className"));var t=e.$("<"+r.result(this,"tagName")+">").attr(a);this.setElement(t,!1)}}}),e.sync=function(a,t,i){var s=I[a];r.defaults(i||(i={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var n={type:s,dataType:"json"};if(i.url||(n.url=r.result(t,"url")||N()),null!=i.data||!t||"create"!==a&&"update"!==a&&"patch"!==a||(n.contentType="application/json",n.data=JSON.stringify(i.attrs||t.toJSON(i))),i.emulateJSON&&(n.contentType="application/x-www-form-urlencoded",n.data=n.data?{model:n.data}:{}),i.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){n.type="POST",i.emulateJSON&&(n.data._method=s);var o=i.beforeSend;i.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",s),o?o.apply(this,arguments):void 0}}"GET"===n.type||i.emulateJSON||(n.processData=!1),"PATCH"!==n.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(n.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var c=i.xhr=e.ajax(r.extend(n,i));return t.trigger("request",t,c,i),c};var I={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var w=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},x=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,D=/\*\w+/g,L=/[\-{}\[\]+?.,\\\^$|#\s]/g;r.extend(w.prototype,c,{initialize:function(){},route:function(a,t,i){r.isRegExp(a)||(a=this._routeToRegExp(a)),r.isFunction(t)&&(i=t,t=""),i||(i=this[t]);var s=this;return e.history.route(a,function(n){var o=s._extractParameters(a,n);i&&i.apply(s,o),s.trigger.apply(s,["route:"+t].concat(o)),s.trigger("route",t,o),e.history.trigger("route",s,t,o)}),this},navigate:function(a,t){return e.history.navigate(a,t),this},_bindRoutes:function(){if(this.routes){this.routes=r.result(this,"routes");for(var e,a=r.keys(this.routes);null!=(e=a.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(L,"\\$&").replace(x,"(?:$1)?").replace(k,function(e,a){return a?e:"([^/]+)"}).replace(D,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,a){var t=e.exec(a).slice(1);return r.map(t,function(e){return e?decodeURIComponent(e):null})}});var z=e.History=function(){this.handlers=[],r.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,O=/^\/+|\/+$/g,A=/msie [\w.]+/,P=/\/$/;z.started=!1,r.extend(z.prototype,c,{interval:50,getHash:function(e){var a=(e||this).location.href.match(/#(.*)$/);return a?a[1]:""},getFragment:function(e,a){if(null==e)if(this._hasPushState||!this._wantsHashChange||a){e=this.location.pathname;var t=this.root.replace(P,"");e.indexOf(t)||(e=e.substr(t.length))}else e=this.getHash();return e.replace(_,"")},start:function(a){if(z.started)throw Error("Backbone.history has already been started");z.started=!0,this.options=r.extend({},{root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),i=document.documentMode,s=A.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);this.root=("/"+this.root+"/").replace(O,"/"),s&&this._wantsHashChange&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var n=this.location,o=n.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!o?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&o&&n.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment+n.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),z.started=!1},route:function(e,a){this.handlers.unshift({route:e,callback:a})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(e){var a=this.fragment=this.getFragment(e),t=r.any(this.handlers,function(e){return e.route.test(a)?(e.callback(a),!0):void 0});return t},navigate:function(e,a){if(!z.started)return!1;if(a&&a!==!0||(a={trigger:a}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var t=this.root+e;if(this._hasPushState)this.history[a.replace?"replaceState":"pushState"]({},document.title,t);else{if(!this._wantsHashChange)return this.location.assign(t);this._updateHash(this.location,e,a.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(a.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,a.replace))}a.trigger&&this.loadUrl(e)}},_updateHash:function(e,a,t){if(t){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+a)}else e.hash="#"+a}}),e.history=new z;var B=function(e,a){var t,i=this;t=e&&r.has(e,"constructor")?e.constructor:function(){return i.apply(this,arguments)},r.extend(t,i,a);var s=function(){this.constructor=t};return s.prototype=i.prototype,t.prototype=new s,e&&r.extend(t.prototype,e),t.__super__=i.prototype,t};f.extend=g.extend=w.extend=$.extend=z.extend=B;var N=function(){throw Error('A "url" property or function must be specified')},j=function(e,a){var t=a.error;a.error=function(i){t&&t(e,i,a),e.trigger("error",e,i,a)}}}).call(this);